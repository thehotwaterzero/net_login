# 校园网自动登录系统

一个基于 Python 和 Playwright 的校园网自动登录工具，支持图形化界面操作，可自动检测网络状态并在断线时自动重新登录。

## ✨ 主要功能

- 🔐 **自动登录**：模拟浏览器操作，自动填写账号密码并登录
- 👀 **智能监控**：定时检查网络登录状态，断线自动重连
- 🖥️ **图形界面**：基于 tkinter 的友好 GUI，操作简单直观
- 📊 **日志记录**：实时显示运行日志，自动保存到文件
- 🔄 **系统托盘**：支持最小化到系统托盘，后台静默运行
- ⚙️ **灵活配置**：可自定义登录地址、检查间隔、浏览器路径等
- 🚀 **自动启动**：配置后每次启动自动开始监控
- 🌐 **镜像加速**：使用国内镜像源加速浏览器驱动下载

## 📋 系统要求

- **操作系统**：Windows 10/11（其他平台理论上也支持）
- **Python 版本**：3.13+
- **包管理器**：[uv](https://docs.astral.sh/uv/)（推荐）或 pip

## 🚀 快速开始

### 1. 克隆项目

```bash
git clone <repository-url>
cd net_login
```

### 2. 安装依赖

使用 uv（推荐）：
```bash
uv sync
```

### 3. 配置账号

首次运行时，程序会自动检测浏览器驱动：

```bash
uv run gui_tk.py
```

如果未安装浏览器驱动，会弹出安装提示，点击"是"自动安装（约 170 MB，使用国内镜像加速）。

启动后点击 **⚙️ 打开配置** 按钮，填写以下信息：

- **账号**：你的学号
- **密码**：登录密码
- **登录地址**：默认为 `https://raas.hzu.edu.cn/`
- **下载镜像源**：浏览器驱动下载源（默认使用 npmmirror）
- **Playwright Cache**：浏览器驱动存储路径（默认 `browsers`）
- **检查间隔**：网络状态检查间隔，建议 30-300 秒

点击 **保存** 后，程序会自动开始监控。

## 🎮 使用说明

### 主界面按钮

- **🔐 测试登录**：手动测试一次登录流程，验证配置是否正确
- **▶ 开始监控**：启动自动监控，定时检查并自动登录（配置后自动启动）
- **⏸ 停止监控**：停止自动监控
- **⚙️ 打开配置**：修改账号密码等配置信息
- **🧹 清空日志**：清除界面上的日志显示
- **📦 安装依赖**：手动安装/重装 Playwright 浏览器驱动

### 系统托盘功能

点击窗口关闭按钮时会弹出选择对话框：

- **⚫ 最小化到托盘**：隐藏窗口到系统托盘，程序继续运行
- **❌ 退出程序**：完全关闭程序
- **取消**：返回主窗口

在系统托盘中：
- 双击图标或右键选择"显示主窗口"恢复窗口
- 右键选择"退出"完全关闭程序

## � 打包发布

### 使用 PyInstaller 打包成 exe

项目已配置好打包脚本，可以一键打包成 Windows 可执行文件：

#### 快速打包（推荐）

双击运行或在命令行执行：
```bash
.\build.bat
```

该脚本会自动完成以下操作：
1. 同步项目依赖（uv sync）
2. 安装 PyInstaller
3. 执行打包流程
4. 整理输出文件
5. 打开输出目录

#### 手动打包

如果需要更多控制：

```bash
# 1. 确保依赖已安装
uv sync
uv pip install pyinstaller

# 2. 运行打包脚本
uv run python build.py

# 或直接使用 PyInstaller
uv run pyinstaller build.spec --clean
```

### 打包输出

打包完成后，会在 `dist/校园网自动登录/` 目录生成：

```
dist/校园网自动登录/
├── 校园网自动登录.exe      # 主程序（双击运行）
├── _internal/              # 程序依赖文件
├── .env.example            # 配置文件模板
├── README.txt              # 详细使用说明
├── 快速开始.txt            # 快速入门指南
└── logs/                   # 日志目录（自动创建）
```

### 分发说明

打包后的程序可以直接分发给其他用户使用，无需安装 Python 环境：

1. **压缩整个目录**：将 `dist/校园网自动登录` 文件夹打包成 zip
2. **用户解压后**：
   - 将 `.env.example` 重命名为 `.env`
   - 编辑 `.env` 填写账号密码
   - 双击 `校园网自动登录.exe` 运行
   - 首次运行会自动下载浏览器驱动（约 170 MB）

### 打包特性

- ✅ 无控制台窗口（纯 GUI）
- ✅ UPX 压缩，减小体积
- ✅ 包含所有必要依赖
- ✅ 配置文件外置，方便修改
- ✅ 自动检测并安装浏览器驱动
- ✅ 兼容 Windows 10/11

### 注意事项

- 首次运行需要联网下载浏览器驱动
- Windows Defender 可能误报，需要添加信任
- 打包后的程序体积约 50-80 MB（不含浏览器驱动）
- 浏览器驱动首次下载约 170 MB

## 📁 项目结构

```
net_login/
├── gui_tk.py              # GUI 主程序（推荐使用）
├── main.py                # CLI 命令行版本
├── ui_layout_tk.py        # GUI 界面布局定义
├── setup.py               # 浏览器驱动安装脚本
├── install_autostart.py   # Windows 开机自启动配置
├── build.py               # 打包脚本（Python）
├── build.bat              # 打包脚本（批处理，推荐）
├── build.spec             # PyInstaller 配置文件
├── .env                   # 配置文件（首次运行自动创建）
├── .env.example           # 配置文件模板
├── pyproject.toml         # 项目依赖配置
├── logs/                  # 日志文件目录
├── browsers/              # Playwright 浏览器驱动（自动下载）
├── dist/                  # 打包输出目录
└── website/               # 网页静态文件（参考）
```

## ⚙️ 配置说明

配置信息保存在 `.env` 文件中（需手动创建 `.env` 文件，并复制 `.env.example` 文件内容），支持以下选项：

```env
# 账号密码
CAMPUS_USERNAME=你的学号
CAMPUS_PASSWORD=你的密码

# 登录网站地址
LOGIN_URL=https://raas.hzu.edu.cn/

# Playwright 浏览器下载镜像源
# 国内推荐: https://npmmirror.com/mirrors/playwright/
# 官方源: https://playwright.azureedge.net/
PLAYWRIGHT_DOWNLOAD_HOST=https://npmmirror.com/mirrors/playwright/

# Playwright 浏览器驱动下载路径
# 默认: browsers (项目目录下的 browsers 文件夹)
# 可以设置为绝对路径，例如: D:/playwright-browsers
PLAYWRIGHT_BROWSERS_PATH=browsers

# 网络状态检查间隔（秒）
# 建议设置: 30-600 秒之间
CHECK_INTERVAL_SECONDS=30
```

## 🔧 高级功能

### 命令行版本

如果不需要图形界面，可以使用命令行版本：

```bash
uv run main.py
```

命令行版本会持续在后台监控，适合在服务器或无界面环境中运行。

### 手动安装浏览器驱动

如果自动安装失败，可以手动运行：

```bash
uv run setup.py
```

## 🐛 故障排除

### 登录失败

1. 检查账号密码是否正确
2. 确认登录网址是否正确
3. 查看日志中的具体错误信息
4. 尝试手动在浏览器中登录，确认网站是否正常

### 浏览器驱动安装失败

1. 检查网络连接是否正常
2. 尝试切换镜像源（官方源 ↔ 国内镜像）
3. 手动运行 `uv run setup.py` 查看详细错误
4. 确保有足够的磁盘空间（至少 200 MB）

### 监控间隔不准确

- 检查配置的间隔时间是否合理（建议 30-300 秒）
- 确保程序未被系统休眠或暂停

### 程序无法启动

1. 确认 Python 版本为 3.13+
2. 重新运行 `uv sync` 安装依赖
3. 查看终端中的错误信息

## 📝 开发说明

### 依赖库

- **playwright**: 浏览器自动化框架
- **python-dotenv**: 环境变量管理
- **pystray**: 系统托盘支持
- **pillow**: 图像处理（托盘图标）
- **schedule**: 定时任务（仅 CLI 版本）

### 主要组件

- **LoginWorker**: 登录工作线程，负责执行登录流程
- **MonitorWorker**: 监控工作线程，定时检查网络状态
- **MainWindow**: 主窗口类，管理 GUI 和业务逻辑

### 代码特性

- 多线程设计，UI 不阻塞
- 按钮防抖保护，避免重复点击
- 线程安全的日志记录
- 优雅的错误处理

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目仅供学习交流使用。

## 🙏 致谢

- [Playwright](https://playwright.dev/) - 强大的浏览器自动化工具
- [npmmirror](https://npmmirror.com/) - 提供国内镜像加速

---

**注意**：请妥善保管你的账号密码，不要将 `.env` 文件上传到公开仓库。
